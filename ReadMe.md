#  upgrade by golang
用golang实现的自更新程序，因为系统机制的问题，主要是解决了windows下软件自更新的问题。\
本程序不带下载模块，实现停止掉旧版本程序，然后启动新版本程序。

### windows说明:
应为windows的特殊机制，运行中的程序是不允许被移动、修改、覆盖、删除，所以你得windows下的程序要实现自更新必须借助独立的更新程序

### linux说明:
大部分linux允许直接修改已在运行中的程序，直接把下载下来的新版本程序替换掉正在运行的老版本程序，然后重新启动程序就可以了。\
当然如果你使用的版本如centos刚好不允许在一般权限下这样做，那您就可以使用我们的linux版本来解决这个问题。

### BSD/Unix说明:
大部分unix在程序运行时，是锁定程序不能被移动、修改、覆盖和删除的，所以unix下您同样也需要。

### 准备工作:
1. 需要把upgrade程序放在您当前运行程序的同一个目录。
2. 您需要更新的版本必须放在当前目录下的new_version/目录下。
3. 保证new_version/目录下的新版本程序名和当前运行程序的程序名一致。
4. 您需要在当前程序启动`127.0.0.1:7777`端口用于告诉upgrade程序您已经准备要更新程序了。
5. 需要您的新程序在启动的时候想`127.0.0.1:7778`端口发送running，告诉upgrade更新完成了。
6. 使用参数 `-n <pragram name>` 来告诉upgrade你当前运行的程序名。

### 工作原理
1. 首先，您的程序需要抓取了新版到本地目录更新目录 ./new_version/,当然你可以可以只修改编译。
2. 执行upgrade程序，`-n <program name>` -n参数指定你程序的名称，不指定的话默认是client
3. upgrade启动后会监听本地 `127.0.0.1:7778` 端口，你可以通过tcp通讯来确认upgrade是否真的启动了，这里不用进程方式来严查，是方式重名程序存在。
4. upgrade会主动发送upgrade指令到 `127.0.0.1:7777` 端口，以便确定您的程序确认要更新，所以你得程序需要再退出之前监听本地7777端口。
5. upgrade确认您要更新后，会等待 7777端口关闭，证明您的旧版本程序已经停止运行了。
6. upgrade会检测/new_version/下的新版本程序是否存在，备份老版本程序，并移动到当前目录。
7. 如果新版本程序不存在upgrade程序会自动启动旧版本程序。
8. 更新完成后，upgrade程序会等待新版本程序想7777端口发送running，确定您的新版本程序已经启动了。
9. 确定您的新版本程序启动后，upgrade会退出运行。
